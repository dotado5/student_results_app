import Head from "next/head";
import { Inter } from "next/font/google";
import styles from "@/styles/Home.module.css";
import { useState } from "react";
import axios from "axios";
import { useDispatch } from "react-redux";
import { login } from "@/feature/userSlice";
import { useRouter } from "next/router";

export default function Home() {
  const [password, setPassword] = useState("");
  const [matric, setMatric] = useState("");

  const dispatch = useDispatch();
  const router = useRouter();

  async function Signin(e) {
    e.preventDefault();

    await axios
      .post(
        "https://bsc-project-a36k.onrender.com/signin",
        { matric: matric, password: password },
        {
          headers: {
            "Content-Type": "application/json",
          },
        }
      )
      .then((res) => {
        console.log(res),
          dispatch(
            login({
              name: res.data.user_name,
              matric: res.data.user_matric,
              tutorial: res.data.user_tut_score,
              practical: res.data.user_prac_score,
              test: res.data.user_test_score,
              exam: res.data.user_exam_score,
              total: res.data.user_total,
              feedback: res.data.user_feedback,
            })
          );
        router.push("/dashboard/student");
      })
      .catch((err) => console.log(err));

    // await fetch("http://127.0.0.1:5000/signin", {
    //   method: "POST",
    //   headers: {
    //     "Content-Type": "application/json",
    //   },
    //   body: JSON.stringify({
    //     matric: matric,
    //     password: password,
    //   }),
    // })
    //   .then((response) => console.log(response))
    //   .catch((err) => console.log(err));
  }

  return (
    <>
      <Head>
        <title>My Project</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <section className={styles.left}>
          <div className={styles.line1}></div>
          <div className={styles.line2}></div>
          <div className={styles.line3}></div>
        </section>
        <section className={styles.right}>
          <div>
            <h2>Log in</h2>
            <h3>Welcome Back</h3>
            <p>Enter your credentials to access your dashboard</p>
            <form action="">
              <label htmlFor="matric">Matric Number </label>
              <input
                type="text"
                id="matric"
                placeholder="Enter your matric number"
                onChange={(e) => setMatric(e.target.value)}
              />
              <label htmlFor="password">Password </label>
              <input
                type="password"
                id="password"
                placeholder="Enter your unique password"
                onChange={(e) => setPassword(e.target.value)}
              />
              <span>Forgot password?</span>
              <button onClick={Signin}>Log in</button>
            </form>
          </div>
        </section>
      </main>
    </>
  );
}
